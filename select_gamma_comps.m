clear all ; close all
cd C:\shared\allres
subs = {'alex','alexandra3','audrey','charest','esteban','fabio','gab','gabriella','genevieve','gina','guillaume','jeremie','julie','katrine','leila','lisa','marc',...
    'marie','mathieu','maxime','menglu','mingham','patricia','po','russell','suhan2','sunachakan','tah','tegan2','vincent'} ; 
trigs = {'S 11','S 12','S 13','S 14','S 15','S 16'} ; 
goodcs = {[5,8,9,15,19,20,25,28,29],[4,5,8,10,15,16,21,22,24,29,31,39,40],[2,3,4,5,6,7,8,10,14,15,16,21,44],[3,7,9,10,16,23,26,30],[14,15,17,25],...
    [3,5,6,15,18,19,25,29],[4,5,7,8,12,14,18,21,28],[3,5,6,7,10,13,14,23,40],[3,4,7,8,10,16,17,26,38],[6,10,12,13,14,16,22,42],[4,9,17,18,20,28,30,35],...
    [6,7,8,14,15,16,21,28,30,32],[4,5,8,9,12,18,23,26,35,38],[2,5,6,7,11,12,15,22,28,34,36],[2,3,4,6,7,10,19],[4,6,7,13,14,18,20,21,28,31,38],...
    [2,4,5,6,7,8,9,10,11,12,14,19,32],[4,6,8,10,11,13,20,23,31,35,37,48],[1,2,5,8,9,14,16,19,20,21,22,25,32],[2,7,8,11,26],[4,5,6,7,8,9,11,12,13,17,18,19,23,37],...
    [3,5,7,8,9,12,21,28],[5,6,8,11,13,15,17,20,21,28,31,40,44],[5,6,7,9,10,13,15,16,21,23,25,28,31,32,33,41],[4,5,6,8,9,10,19,21,25,26],...
    [3,5,6,7,8,9,10,14,15,18,20,27,31,34],[3,4,5,6,7,8,10,11,12,13,15,16,27,29],[1,3,6,7,8,9,23,24,25,27,30],[9,10,21,25,29,31,33],...
    [4,5,7,8,9,11,14,15,17,21,29,42],[2,3,4,5,7,8,9,10,11,13,14,15,18,26,36]} ;

postgoodcs = {[8,9,25],[4,5,22,24],[14,15,21],[7,9,16],[14,15,25],[15,25,29],[8,12,21],[5,7,23,40],[3,7,8,17],[6,10,13,16],[4,35],[8,15,37],[8,12,18,26],...
    [2,6,15,22],[10,19],[4,13,20],[2,4,8],[4,6,10],[2,20,22],[2,7,11],[5,9,11],[5,9,12],[13,15,16,23],[6,8,9],[3,10,20,31,34],[6,7,12,29],[1,6,7],[10,25,31],...
    [8,14,17,21,42],[3,4,11]} ; 

postgoodcs2 = {[5,8,9,15,25,28],[4,5,8,10,15,22,24],[3,5,14,15,16,21],[7,9,16,23],[14,15,25],[15,18,19,25,29,31],[8,12,21],[5,7,23,40],[3,7,8,17],[6,10,13,16,42,48],[4,22,30,35],[7,8,15,32,37],[8,12,18,23,26,38],[2,6,7,11,15,22,36,43,53],[2,3,4,6,10,19],[4,13,20,21,28,31,38],[2,4,8,9,14,32],[4,6,8,10,23,35,48],[2,22,25],[2,7,8,11,26],[4,5,7,8,9,11],[5,7,8,9,12],[13,15,16,23,25,32],[6,8,9,10],[3,10,20,31,34],[6,7,10,11,12,15,29],[1,6,7,9,23],[9,10,25,31],[4,5,8,14,17,21,24,42],[3,4,11,18]} ;


for sb=1:length(subs)
    cd(['c:/shared/allres/',subs{sb}]) ; 
    ls 
    fullica = load('fullica.mat') ; fullica = fullica.fullica ; 
    weights = fullica{1} ; sphere = fullica{2} ; winv = pinv(weights*sphere) ; 
    times = load('times') ; times = times.times;  
    freqs = load('freqs') ; freqs = freqs.freqs ; 
    eeg = pop_loadset('cleanfilt.set') ; 
    ersp = load('ersp') ; ersp = ersp.ersp ; 
    bersp = load('bersp') ; bersp = bersp.bersp ;
    figure('units','normalized','outerposition',[0 0 1 1]) ; 
    for i=1:64 ; subplottight(10,14,i*2) ; imagesc(squeeze(mean(bersp([1,3,5],i,:,:),1)),[-2,2]) ; colormap jet ; axis xy ; set(gca,'XTick',[],'YTick',[]) ; end
    for i=1:64 ; subplottight(10,14,i*2-1) ; topoplot(winv(:,i),eeg.chanlocs) ; colormap jet ; axis xy ; text(.55,.1,num2str(i)) ; end
    suptitle(subs{sb}) ;
end


